<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Archaeological Site Profile</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #fafafa;
      margin: 0; padding: 2rem;
      color: #222;
      max-width: 900px;
      margin-left: auto;
      margin-right: auto;
    }
    h1 {
      font-size: 2rem;
      margin-bottom: 1rem;
      border-bottom: 2px solid #ccc;
      padding-bottom: 0.3rem;
    }
    .field {
      margin-bottom: 1rem;
    }
    .label {
      font-weight: bold;
      color: #555;
      margin-bottom: 0.25rem;
    }
    .value {
      background: #fff;
      padding: 0.5rem 0.75rem;
      border-radius: 5px;
      border: 1px solid #ddd;
      word-break: break-word;
    }
    .section {
      margin-top: 2rem;
      padding-top: 1rem;
      border-top: 2px solid #eee;
    }
    a {
      color: #0066cc;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <h1 id="site-name">Loading site...</h1>
  <div id="fields"></div>

  <div class="section" id="wikidata-section" style="display:none;">
    <h2>Wikidata Information</h2>
    <div id="wikidata-content"></div>
  </div>

  <div class="section" id="wikipedia-section" style="display:none;">
    <h2>Wikipedia Summary</h2>
    <div id="wikipedia-content"></div>
  </div>

  <script>
    const DATA_PATH = '/data/output.json';
    const SITE_ID_TO_SHOW = 66294; // ثابت، يمكنك تعديله حسب الحاجة

    function createField(label, value) {
      const container = document.createElement('div');
      container.className = 'field';
      const labelEl = document.createElement('div');
      labelEl.className = 'label';
      labelEl.textContent = label;
      const valueEl = document.createElement('div');
      valueEl.className = 'value';
      valueEl.textContent = value ?? '—';
      container.appendChild(labelEl);
      container.appendChild(valueEl);
      return container;
    }

    async function fetchJSON(url) {
      try {
        const res = await fetch(url);
        if (!res.ok) throw new Error('HTTP error ' + res.status);
        return await res.json();
      } catch(e) {
        console.error('Failed to fetch', url, e);
        return null;
      }
    }

    async function fetchWikipediaSummary(title) {
      if (!title) return null;
      const url = `https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(title)}`;
      const data = await fetchJSON(url);
      if (data && data.extract) {
        return `<h3>${data.title}</h3><p>${data.extract}</p><p><a href="${data.content_urls.desktop.page}" target="_blank" rel="noopener">اقرأ المزيد على ويكيبيديا</a></p>`;
      }
      return null;
    }

    async function fetchWikidataEntity(qid) {
      if (!qid) return null;
      const url = `https://www.wikidata.org/wiki/Special:EntityData/${qid}.json`;
      const data = await fetchJSON(url);
      if (!data) return null;
      const entity = data.entities[qid];
      if (!entity) return null;
      // استخراج تسمية ووصف (إنجليزية أو لغة أخرى)
      const label = entity.labels.en ? entity.labels.en.value : Object.values(entity.labels)[0]?.value || '';
      const description = entity.descriptions.en ? entity.descriptions.en.value : Object.values(entity.descriptions)[0]?.value || '';
      return { label, description, url: `https://www.wikidata.org/wiki/${qid}` };
    }

    async function main() {
      const data = await fetchJSON(DATA_PATH);
      if (!data) {
        document.getElementById('site-name').textContent = 'خطأ في تحميل بيانات الموقع';
        return;
      }

      // البحث عن الموقع حسب ID
      const site = data.find(s => Number(s.id) === SITE_ID_TO_SHOW);
      if (!site) {
        document.getElementById('site-name').textContent = 'الموقع غير موجود';
        return;
      }

      // عرض اسم الموقع
      document.getElementById('site-name').textContent = site.site || site.lab_name || 'موقع أثري';

      const fieldsContainer = document.getElementById('fields');

      // قائمة الحقول الأساسية كما في النموذج الأصلي (تكامل الحقول مع نموذج JSON افتراضي)
      const fieldsToShow = [
        { key: 'id', label: 'معرف الموقع (ID)' },
        { key: 'labnr', label: 'رقم المختبر' },
        { key: 'bp', label: 'BP' },
        { key: 'std', label: 'الانحراف المعياري (STD)' },
        { key: 'cal_bp', label: 'التاريخ المعاير (Cal BP)' },
        { key: 'cal_std', label: 'انحراف التاريخ المعاير' },
        { key: 'delta_c13', label: 'دلتا C13' },
        { key: 'source_database', label: 'قاعدة البيانات المصدر' },
        { key: 'lab_name', label: 'اسم المختبر' },
        { key: 'material', label: 'المادة' },
        { key: 'species', label: 'النوع' },
        { key: 'feature', label: 'الميزة' },
        { key: 'feature_category', label: 'فئة الميزة' },
        { key: 'site', label: 'اسم الموقع' },
        { key: 'context', label: 'السياق' },
        { key: 'period', label: 'الفترة' },
        { key: 'culture', label: 'الثقافة' },
        { key: 'location', label: 'الموقع الجغرافي' },
        { key: 'country', label: 'البلد' },
        { key: 'latitude', label: 'خط العرض' },
        { key: 'longitude', label: 'خط الطول' },
        { key: 'elevation', label: 'الارتفاع' },
        { key: 'comment', label: 'ملاحظات' },
        { key: 'reference', label: 'المرجع' },
        { key: 'notes', label: 'ملاحظات إضافية' },
        { key: 'region', label: 'المنطقة' },
        { key: 'continent', label: 'القارة' }
      ];

      // عرض الحقول
      fieldsToShow.forEach(({ key, label }) => {
        const value = site[key];
        fieldsContainer.appendChild(createField(label, value));
      });

      // عرض ويكيداتا إن وجد
      if (site.wikidata_id) {
        const wikidataSection = document.getElementById('wikidata-section');
        const wikidataContent = document.getElementById('wikidata-content');
        const wdEntity = await fetchWikidataEntity(site.wikidata_id);
        if (wdEntity) {
          wikidataContent.innerHTML = `
            <p><strong>التسمية:</strong> ${wdEntity.label}</p>
            <p><strong>الوصف:</strong> ${wdEntity.description}</p>
            <p><a href="${wdEntity.url}" target="_blank" rel="noopener">رابط ويكيداتا</a></p>
          `;
          wikidataSection.style.display = 'block';
        }
      }

      // عرض ملخص ويكيبيديا إن لم يكن موجود في بيانات الموقع
      if (!site.wikipedia_summary && site.site) {
        const wikipediaSection = document.getElementById('wikipedia-section');
        const wikipediaContent = document.getElementById('wikipedia-content');
        const wikiSummary = await fetchWikipediaSummary(site.site);
        if (wikiSummary) {
          wikipediaContent.innerHTML = wikiSummary;
          wikipediaSection.style.display = 'block';
        }
      }
      // أو عرض ملخص ويكيبيديا من ملف البيانات نفسه إذا موجود
      else if(site.wikipedia_summary) {
        const wikipediaSection = document.getElementById('wikipedia-section');
        const wikipediaContent = document.getElementById('wikipedia-content');
        wikipediaContent.innerHTML = `<p>${site.wikipedia_summary}</p><p><a href="${site.wikipedia_url || '#'}" target="_blank" rel="noopener">اقرأ المزيد على ويكيبيديا</a></p>`;
        wikipediaSection.style.display = 'block';
      }
    }

    main();
  </script>
</body>
</html>
